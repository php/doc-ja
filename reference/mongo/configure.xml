<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 7070675e39b519e95387a2b91b1ee3195edbaa19 Maintainer: takagi Status: working -->

<section xml:id="mongo.installation" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 &reftitle.install;
 <para>
  MongoDB PHP ドライバは、ほぼすべてのシステムで動作します。
  Windows、Mac OS X、Unix そして Linux。リトルエンディアンマシンおよびビッグエンディアンマシン。
  32 ビットマシンおよび 64 ビットマシン。PHP 5.3 から 5.6 (1.6 より前のバージョンは、PHP 5.2 もサポートします)。
 </para>
 <para>
  &pecl.moved;
 </para>

 <simplelist>
  <member>
   <xref linkend="mongo.installation.manual" />
  </member>
  <member>
   <xref linkend="mongo.installation.nix" />
  </member>
  <member>
   <xref linkend="mongo.installation.windows" />
  </member>
  <member>
   <xref linkend="mongo.installation.osx" />
  </member>
  <member>
   <xref linkend="mongo.installation.gentoo" />
  </member>
  <member>
   <xref linkend="mongo.installation.fedora" />
  </member>
  <member>
   <xref linkend="mongo.installation.thirdparty" />
  </member>
 </simplelist>

 <section xml:id="mongo.installation.manual">
  <title>手動インストール</title>

  <para>
   ドライバの開発者や最新のバグフィックス版に興味のあるかたは、
   <link xlink:href="&url.mongodb.github;">Github</link>
   にある最新のソースコードからドライバをコンパイルすることもできます。
   Github に行き、"download" ボタンをクリックしましょう。そして以下のようにします。

   <programlisting role="shell">
<![CDATA[
$ tar zxvf mongodb-mongodb-php-driver-<commit_id>.tar.gz
$ cd mongodb-mongodb-php-driver-<commit_id>
$ phpize
$ ./configure
$ make all
$ sudo make install
]]>
   </programlisting>
  </para>

  <para>
   php.ini を次のように変更します。
  </para>
  <itemizedlist>
   <listitem>
    <para>
     <emphasis>extension_dir</emphasis> 変数が
     <emphasis>mongo.so</emphasis> のあるディレクトリを指すようにします。
     ビルド中に、PHP ドライバをどこにインストールするのかがこのように表示されます。
     <programlisting role="txt">
<![CDATA[
Installing '/usr/lib/php/extensions/no-debug-non-zts-20060613/mongo.so'
]]>
     </programlisting>

      この場所が PHP の拡張モジュール用ディレクトリと一致するかどうかは、次のようにして確認します。

     <programlisting role="shell">
<![CDATA[
$ php -i | grep extension_dir
  extension_dir => /usr/lib/php/extensions/no-debug-non-zts-20060613 =>
                   /usr/lib/php/extensions/no-debug-non-zts-20060613
]]>
     </programlisting>

     もし一致しない場合は、php.ini の <emphasis>extension_dir</emphasis> を変更するか、あるいは <emphasis>mongo.so</emphasis>
     を移動させます。
    </para>
   </listitem>
   <listitem>
    <para>
     PHP の起動時に拡張モジュールを読み込むために、次の行を追加します。

     <programlisting role="ini">
<![CDATA[
extension=mongo.so
]]>
     </programlisting>

    </para>
   </listitem>
  </itemizedlist>

 <section xml:id="mongo.installation.nix">
  <title>*NIX へのインストール</title>

  <para>
   <programlisting role="shell">
<![CDATA[
$ sudo pecl install mongo
]]>
   </programlisting>
   を実行します。
  </para>

  <para>
   CentOS あるいは Redhat を使っている場合は、
   <link xlink:href="&url.mongodb.rpm;">RPM</link>
   からインストールできます。
  </para>

  <para>
   php.ini ファイルに次の行を追加します。
   <programlisting role="ini">
<![CDATA[
extension=mongo.so
]]>
   </programlisting>
  </para>

  <para>
   インストール中に pecl が out of memory となる場合は、php.ini の memory_limit
   が 128M 以上あるかどうかを確認しましょう。
  </para>
 </section>

 <section xml:id="mongo.installation.windows">
  <title>Windows へのインストール</title>

  <para>
   リリースごとのコンパイル済みバイナリが
   <link xlink:href="&url.mongodb.downloads;">S3</link> にあります。
   バージョン、スレッドセーフ/非スレッドセーフ、VCのライブラリのさまざまな組み合わせに対応しています。
   アーカイブを Unzip して、php_mongo.dll を PHP 拡張モジュールのディレクトリ
   (デフォルトは "ext") に置きましょう。
  </para>

  <para>
   php.ini に次の行を追加します。
   <programlisting role="ini">
<![CDATA[
extension=php_mongo.dll
]]>
   </programlisting>
  </para>

  <note>
   <title>Windows ユーザー向けの、追加で必要となる DLL</title>
   <para>
    &ext.windows.path.dll;
    <filename>libsasl.dll</filename>
   </para>
  </note>
 </section>

  <section xml:id="mongo.installation.osx">
   <title>OS X</title>
   <para>
    たいていの場合は、pecl でインストールするのがいちばん簡単です。
    <programlisting role="shell">
<![CDATA[
$ sudo pecl install mongo
]]>
    </programlisting>
   </para>
   <para>
    If you are using <link xlink:href="&url.mac.homebrew;">Homebrew</link>, the
    PHP tap includes formulae for the driver. For example, you might install the
    driver for PHP 5.6 using the following command:
    <programlisting role="shell">
<![CDATA[
$ brew install php56-mongo
]]>
    </programlisting>
   </para>
   <para>
    If you are using <link xlink:href="&url.xampp;">XAMPP</link>, note that it
    has its own pecl binary and php.ini configuration. You should be able to
    install the driver with the following command:
    <programlisting role="shell">
<![CDATA[
$ sudo /Applications/XAMPP/xamppfiles/bin/pecl install mongo
]]>
    </programlisting>
   </para>
   <note>
   <title>Xcode dependency for compiling on OS X</title>
   <para>
    Compiling the driver on OS X will require Xcode developer tools, which may
    be installed with <code>xcode-select --install</code>. If that command is
    not available, you may first need to install the
    <link xlink:href="&url.apple.clt;">Command Line Tools</link> package.
   </para>
  </note>
  </section>

  <section xml:id="mongo.installation.gentoo">
   <title>Gentoo</title>
   <para>
    Gentoo には PHP PECL ドライバのパッケージ dev-php/pecl-mongo があり、
    次のようにすればインストールできます。
   </para>
   <programlisting role="shell">
<![CDATA[
$ sudo emerge -va dev-php/pecl-mongo
]]>
   </programlisting>

   <para>
    PECL を使う場合は、libtool のバージョンが違うというエラーが出るかもしれません。
    ソースからコンパイルするには、aclocal と autoconf を実行しなければなりません。
   </para>
   <programlisting role="shell">
<![CDATA[
$ phpize
$ aclocal 
$ autoconf 
$ ./configure
$ make
$ sudo make install
]]>
   </programlisting>
  </section>
  <section xml:id="mongo.installation.fedora">
   <title>Red Hat</title>
   <para>
    Fedora や CentOS も含みます。
   </para>
   <para>
    これらのシステム上の Apache のデフォルト設定では
    リクエストがネットワーク接続できないようにしており、
    データベースに接続しようとすると "Permission denied"
    というエラーが発生します。もしこの現象に遭遇したら、次のコマンドを実行しましょう。
    <programlisting role="shell">
<![CDATA[
$ /usr/sbin/setsebool -P httpd_can_network_connect 1 
]]>
    </programlisting>
    そして Apache を再起動します (この問題は、SELinux の環境で発生します)。
   </para>
  </section>
 </section>

 <section xml:id="mongo.installation.thirdparty">
  <title>その他のインストール説明</title>
  
  <para>
   PHP 用ドライバのインストールに関するすばらしいチュートリアルが、
   多くのかたによって公開されています。
  </para>

  <itemizedlist>
   <listitem>
    <para>
     <link xlink:href="&url.mongodb.install.osx.homebrew;">
      (Re)installing PHP on Mac OS X
     </link>
    </para>
    <para>
     This article by Justin Hileman details the process of installing PHP and
     additional extensions with Homebrew on OS X. This complements the earlier
     instructions on this page for installing the driver with Homebrew.
    </para>
   </listitem>
   <listitem>
    <para>
     <link xlink:href="&url.mongodb.install.ubuntu.9.10.video;">
      PHP 5.3.1 with Xdebug, MongoDB and Lithium on Ubuntu 9.10 / Apache 2.2
     </link>
    </para>
    <para>This screencast by Jon Adams demonstrates how to quickly get up and
      running with PHP 5.3.1, Xdebug, and MongoDB on Ubuntu 9.10 with Apache.
    </para>
   </listitem>
  </itemizedlist>
 </section>

</section>


<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
