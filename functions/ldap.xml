 <reference id="ref.ldap">
  <title>LDAP 関数</title>
  <titleabbrev>LDAP</titleabbrev>

   <partintro>
    <title>LDAP 入門</title>
     <para>
      LDAP とは Lightweight Directory Access Protocol を意味し、
      "ディレクトリ・サーバー" にアクセスするために使用される
      プロトコルです。
      ディレクトリとは、ツリー構造に情報を保持している特殊な
      データベースのことです。
     </para><para> 
     この概念は、ハードディスクのディレクトリ構造に似ています。
     ただし、その内容は異なっており、ルートディレクトリは "世界" であり、
     最初のレベルのサブディレクトリは "国" となります。
     ディレクトリ構造の下位には、会社や機関、場所のエントリがあります。
     さらに下位には、人やおそらく道具や文書に関するディレクトリエントリも
     あります。
     </para><para>
     ハードディスクにあるサブディレクトリにあるファイルを参照するには、
     次のようにすることでしょう。
     </para>
 <literallayout>
     /usr/local/myapp/docs
 </literallayout>
     <para>
     
     スラッシュは、リファレンスの各部分を区分し、解釈は左から右に行われます。
     </para><para>
     LDAP においてこの完全に正しいファイル参照に等価なものは
     "区分された名前(distinguished name)"であり、単に "dn" として
     参照されます。
      例として dn が次のようになっているとしましょう。
     </para>
 <literallayout>
     cn=John Smith,ou=Accounts,o=My Company,c=US
 </literallayout>
     <para>
     カンマは各部分を区分し、右から左に解釈されます。
     この dn は次のように解釈されます。
     </para>
 <literallayout>
     country = US
     organization = My Company
     organizationalUnit = Accounts
     commonName = John Smith
 </literallayout>
     <para>
     ハードディスクのディレクトリ構造を管理する手法について明確な規約がないのと同様に、
     ディレクトリサーバーマネージャーは、
     目的に適したあらゆる構造を設定することが可能です。
     しかし、実用的にはいくつかの慣習があります。
     利用可能なものに関する情報を持たずにデータベースを使用する
     ことができないのと同様に
     ディレクトリの構造に関する情報なくして
     ディレクトリサーバーにアクセスするコードを書くことはできない
     ということが言えます。
     </para>
 
    <sect1 id="ldap-example">
     <title>完全なコードの例</title>
      <para>
      あるディレクトリサーバーから姓が "S" から始まる全てのエントリに
      関する情報を検索し、名前と電子メールアドレスで検索結果を表示します。
      </para>
 
     <example>
      <title>LDAP 検索の例</title>
 <programlisting role="php">
 &lt;?php
 // LDAP の基本シーケンスは、接続、バインド、検索、検索結果の解釈、
 // 接続のクローズです。
 
 echo "&lt;h3>LDAP query test&lt;/h3>";
 echo "Connecting ...";
 $ds=ldap_connect("localhost");  // 有効な LDAP サーバーに違いない!
 echo "connect result is ".$ds."&lt;p>";
 
if ($ds) { 
    echo "Binding ..."; 
    $r=ldap_bind($ds);     // これは "匿名" バインドで、通常は
                           // 読みこみのみのアクセスとなります。
    echo "Bind result is ".$r."&lt;p>";
 
    echo "Searching for (sn=S*) ...";
    // 名前(surname)エントリを検索
    $sr=ldap_search($ds,"o=My Company, c=US", "sn=S*");  
    echo "Search result is ".$sr."&lt;p>";

    echo "Number of entires returned is ".ldap_count_entries($ds,$sr)."&lt;p>";

    echo "Getting entries ...&lt;p>";
    $info = ldap_get_entries($ds, $sr);
    echo "Data for ".$info["count"]." items returned:&lt;p>";
 
    for ($i=0; $i<$info["count"]; $i++) {
        echo "dn is: ". $info[$i]["dn"] ."&lt;br>";
        echo "first cn entry is: ". $info[$i]["cn"][0] ."&lt;br>";
        echo "first email entry is: ". $info[$i]["mail"][0] ."&lt;p>";
    }
 
    echo "Closing connection";
    ldap_close($ds);
 
} else {
     echo "&lt;h4>Unable to connect to LDAP server&lt;/h4>";
}
?>
     </programlisting>
    </example>
    
    <sect2>
     <title>PHP LDAP コールの使用法</title>
     <para>
      ミシガン大の ldap-3.3 パッケージまたは Netscape Directory SDK
      3.0 のどちらかから完全な LDAP クライアントライブラリを取得する必
      要があります。また、PHP の LDAP コールを動作させるには、
      PHP を LDAP サポートを有効にして再コンパイルする必要があります。
     </para>
     <para>
      LDAP コールを使用する前に、以下のことを知っておいてください。
 
     <itemizedlist>
      <listitem>
       <para>
       使用するディレクトリサーバーの名前またはアドレス
       </para>
      </listitem>
      <listitem>
       <para>
       サーバーの "base dn" (このサーバーがあるワールドディレクトリ
       の部分で、"o=My Company,c=US" のようにすることができます)
       </para>
      </listitem>
      <listitem>
       <para>
       サーバーへのアクセスにパスワードを必要とするかどうか。
       (多くのサーバーは "匿名バインド" に関して読みこみを
       許可するが、他の処理についてはパスワードを要求します)
       </para>
      </listitem>
     </itemizedlist></para>
 
      <para>
      アプリケーションとして作成する LDAP コールのシーケンスは、
      通常、次のようなパターンに沿っています。
 <literallayout>
   ldap_connect()    // サーバーへの接続を確立
      |
   ldap_bind()       // 匿名または認証された "ログイン"
      |
   ディレクトリの検索または更新等を行い、結果を表示する
      |
   ldap_close()      // "ログアウト"
 </literallayout></para>
    </sect2>
 
 
    <sect2>
     <title>他の情報</title>
      <para>
      LDAP に関する多くの情報を以下の場所で得ることができます。
      </para>
 
     <itemizedlist>
      <listitem>
       <para>
        <ulink url="&url.ldap.netscape;">Netscape</ulink>
       </para>
      </listitem>
      <listitem>
       <para>
        <ulink url="&url.ldap.michigan;">ミシガン大学</ulink>
       </para>
      </listitem>
      <listitem>
       <para>
        <ulink url="&url.ldap.openldap;">OpenLDAP プロジェクト</ulink>
       </para>
      </listitem>
      <listitem>
       <para>
        <ulink url="&url.ldap.ldapworld;">LDAP World</ulink>
       </para>
      </listitem>
     </itemizedlist>
 
      <para>    
      ネットスケープ SDK には、.html 形式の有用なプログラマー用ガイドが
      含まれています。
      </para>
    </sect2>
   </sect1>
 
   </partintro>
 
 
  <refentry id="function.ldap-add">
   <refnamediv>
    <refname>ldap_add</refname>
    <refpurpose>LDAP ディレクトリにエントリを付加する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_add</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>dn</parameter></paramdef>
      <paramdef>array <parameter>entry</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功の場合にTRUE 、エラーの場合に FALSE を返します。
    </para><para>  
    <function>ldap_add</function> 関数は、LDAP ディレクトリにエントリを
    加えるために使用されます。
    加えられるエントリの DN は、dn により指定されます。
    配列entryは、そのエントリに関する情報を指定します。
    エントリの値は、個々の属性によりインデックスが作成されています。
    ある属性に関して複数の値がある場合は、0 から始まる整数で添字
    が作成されます。
    </para>
	<informalexample>
<literallayout>
    entry["attribute1"] = value
    entry["attribute2"][0] = value1
    entry["attribute2"][1] = value2
</literallayout>
     </informalexample>
      <example>
       <title>認証型バインドの例</title>
 <programlisting role="php">
 &lt;?php
 $ds=ldap_connect("localhost");  // LDAP サーバーはこのホストであると仮定
 
 if ($ds) {
     // 更新アクセスを行うために適当な dn でバインドする
     $r=ldap_bind($ds,"cn=root, o=My Company, c=US", "secret");
 
     // prepare data
     $info["cn"]="John Jones";
     $info["sn"]="Jones";
     $info["mail"]="jonj@here.and.now";
     $info["objectclass"]="person";
 
     // データをディレクトリに追加
     $r=ldap_add($ds, "cn=John Jones, o=My Company, c=US", $info);
 
     ldap_close($ds);
 } else {
     echo "LDAP サーバーに接続できません"; 
 }
 ?>
 </programlisting>
      </example>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-mod-add">
   <refnamediv>
    <refname>ldap_mod_add</refname>
    <refpurpose>現在の属性に属性を追加する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_mod_add</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>dn</parameter></paramdef>
      <paramdef>array <parameter>entry</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功時にtrue、エラー時にfalseを返します。</para>
 	<para>
	この関数は、指定したdnに属性を追加します。この関数は、
	オブジェクトレベルではなく属性レベルで修正を行います。
	オブジェクトレベルの追加は、<function>ldap_add</function> 関数
	により行います。</para>
   </refsect1>
  </refentry>

  <refentry id="function.ldap-mod-del">
   <refnamediv>
    <refname>ldap_mod_del</refname>
    <refpurpose>現在の属性から属性を削除する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_mod_del</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>dn</parameter></paramdef>
      <paramdef>array <parameter>entry</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功時にtrue、エラー時にfalseを返します。</para>
    	<para>
	この関数は、指定した dn から属性を削除します。この関数は、
	オブジェクトレベルではなく属性レベルで修正を行います。
	オブジェクトレベルの削除は、<function>ldap_del</function> 関数
	により行います。</para>
   </refsect1>
  </refentry>

  <refentry id="function.ldap-mod-replace">
   <refnamediv>
    <refname>ldap_mod_replace</refname>
    <refpurpose>属性を新規の値に置換する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_mod_replace</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>dn</parameter></paramdef>
      <paramdef>array <parameter>entry</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功時にtrue、エラー時にfalseを返します。</para>
	<para>
	この関数は、指定した dn で置換を行います。この関数は、
	オブジェクトレベルではなく属性レベルで修正を行います。
	オブジェクトレベルの修正は、<function>ldap_modify</function> 関数
	により行います。</para>
   </refsect1>
  </refentry>

  <refentry id="function.ldap-bind">
   <refnamediv>
    <refname>ldap_bind</refname>
    <refpurpose>LDAP ディレクトリにバインドする</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_bind</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter><optional>bind_rdn</optional></parameter></paramdef>
      <paramdef>string <parameter><optional>bind_password</optional></parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    指定した RDN およびパスワードを用いて LDAP ディレクトリをバインドします。
    成功の場合にTRUE をエラーの場合に FALSE を返します。</para>
    <para>  
    <function>ldap_bind</function> は、ディレクトリに関するバインド動作を行います、
    bind_rdn および bind_password はオプションです。
    指定されない場合は、匿名(anonymous) バインドが試みられます。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-close">
   <refnamediv>
    <refname>ldap_close</refname>
    <refpurpose>LDAP サーバーへのリンクを閉じる</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_close</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功の場合にTRUE を、エラーの場合に FALSE を返します。</para>
    <para>  
    <function>ldap_close</function> は、指定した <parameter>link_identifier</parameter> 
     が指すLDAP サーバーへのリンクを閉じます。</para>
     <para>
     このコールは、内部的には <function>ldap_unbind</function> と同じです。
     LDAP API は、<function>ldap_unbind</function> コールを行うため、
     <function>ldap_close</function> をコールする手間を考えるとこの関数を使用する方が
     良いでしょう。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-connect">
   <refnamediv>
    <refname>ldap_connect</refname>
    <refpurpose>LDAP サーバーへ接続する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_connect</function></funcdef>
      <paramdef>string <parameter><optional>hostname</optional></parameter></paramdef>
      <paramdef>int <parameter><optional>port</optional></parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功した場合には、正の LDAP リンクIDを、エラーの場合に FALSE を返します。</para>
    <para>  
    <function>ldap_connect</function> は、
    <parameter>hostname</parameter> と <parameter>port</parameter> で
    指定された LDAP サーバーへの接続を確立します。
    引数は両方ともオプションです。
    引数が指定されない場合、既に開かれているリンクのリンク ID が
    返されます。
    <parameter>hostname</parameter> のみが指定された場合、
    ポートのデフォルト値は、389 となります。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-count-entries">
   <refnamediv>
    <refname>ldap_count_entries</refname>
    <refpurpose>サーチ時のエントリ数をカウントする</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_count_entries</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
     結果のエントリを数えます。エラーの場合は、FALSE?ߔします。
    </para>
    <para>  
     <function>ldap_count_entries</function> は、サーチ実行の結果として
     保持されたエントリの数を返します。
     <parameter>result_identifier</parameter> は、LDAP 内部の結果を特
     定します。
    </para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-delete">
   <refnamediv>
    <refname>ldap_delete</refname>
    <refpurpose>ディレクトリからエントリを削除する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_delete</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>dn</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功の場合にTRUE を、エラーの場合に FALSE を返します。</para>
    <para>  
    <function>ldap_delete</function> 関数は、dn より指定された LDAP ディレクトリに
    おける特定のエントリを削除します。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-dn2ufn">
   <refnamediv>
    <refname>ldap_dn2ufn</refname>
    <refpurpose>DN をユーザに分かりやすい名前のフォーマットに変換する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>string <function>ldap_dn2ufn</function></funcdef>
      <paramdef>string <parameter>dn</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
	<function>ldap_dn2ufn</function> 関数は、型名を取り除いて
	DN をよりユーザーに分かりやすい形式に
	変換するために使用されます。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-explode-dn">
   <refnamediv>
    <refname>ldap_explode_dn</refname>
    <refpurpose>DN を構成要素毎に分割する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>array <function>ldap_explode_dn</function></funcdef>
      <paramdef>string <parameter>dn</parameter></paramdef>
      <paramdef>int <parameter>with_attrib</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
	<function>ldap_explode_dn()</function> 関数は、
	<function>ldap_get_dn</function> により
	返された DN を分割し複数の要素に分けるために使用されます。
	各部分は、相対区分名(Relative Distinguished Name または RDN)
	と呼ばれます。
	<function>ldap_explode_dn</function> は、これらの全ての要素を含む
	配列を返します。
	<parameter>with_attrib</parameter> は、
	RDN が値のみを返すのか、あるいは、属性を同時に返すのかを
	指定するために使用されます。
	属性を有する RDN （すなわち、属性=値 フォーマットで) を得るためには
	<parameter>with_attrib</parameter> を 0 とし、
	値のみを得るためには1 にセットします。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-first-attribute">
   <refnamediv>
    <refname>ldap_first_attribute</refname>
    <refpurpose>最初の属性を返す</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>string <function>ldap_first_attribute</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_entry_identifier</parameter></paramdef>
      <paramdef>int <parameter>ber_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功した場合、エントリの最初の属性を返します。
    エラーの場合に FALSE を返します。</para>
    <para>  
    エントリの読み込みと同様に、属性も特定のエントリから一つずつ
    読み込まれます。
    <function>ldap_first_attribute</function> は、エントリ ID により指された
    エントリにおける最初の属性を返します。
    残りの属性は、<function>ldap_next_attribute</function> を逐次コールする
    ことにより得ることができます。
    <parameter>ber_identifier</parameter> は、内部メモリにおける位置ポインタ
    の ID です。この ID は、参照渡しされます。
    同じ <parameter>ber_identifier</parameter> が
    <function>ldap_next_attribute</function> 関数に渡された場合、
    そのポインタは修正されます。
    </para>
    <para>
	<function>ldap_get_attributes</function> も参照下さい。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-first-entry">
   <refnamediv>
    <refname>ldap_first_entry</refname>
    <refpurpose>初の結果 ID を返す</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_first_entry</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功時に最初のエントリに関する結果エントリ ID を返します。
    エラーの場合に FALSE を返します。</para>
    <para>  
    LDAP 結果におけるエントリは、<function>ldap_first_entry</function> 
    および <function>ldap_next_entry</function>関数を用いて連続的に読み込まれます。
    <function>ldap_first_entry</function> は、結果における最初のエントリに関する
    エントリ ID を返します。
    このエントリ ID は、結果から連続的にエントリを得るために、
    <function>lap_next_entry</function> ルーチンに渡されます。</para>
    	<para>
	<function>ldap_get_entries</function> も参照下さい。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-free-result">
   <refnamediv>
    <refname>ldap_free_result</refname>
    <refpurpose>結果メモリを開放する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_free_result</function></funcdef>
      <paramdef>int <parameter>result_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功した場合にTRUE を、エラーの場合に FALSE を返します。</para>
    <para>  
    <function>ldap_free_result</function> は、結果を保持するために内部的に確保され、
    <parameter>result_identifier</parameter> が指すメモリを開放します。
    全ての結果メモリは、スクリプト実行終了時に自動的に開放されます。</para>
     <para>
     通常、LDAP の結果用に確保された全てのメモリはスクリプトの実行終了時
     に開放されます。連続的な検索を行うスクリプトのように大きな
     結果セットを返す場合、スクリプトにより使用される実行用メモリーを
     小さく保つために <function>ldap_free_result</function> 
     をコールすることが可能です。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-get-attributes">
   <refnamediv>
    <refname>ldap_get_attributes</refname>
    <refpurpose>サーチ結果エントリから属性を得る</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>array <function>ldap_get_attributes</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
       <paramdef>int
       <parameter>result_entry_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功時に完全なエントリ情報を多次元配列で返します。エラーの場合、
     FALSE を返します。</para>
    <para>  
    <function>ldap_get_attributes</function> 関数は、探索結果における
    エントリから属性と値を間単に読み込むために使用されます。
    返り値は、属性と値の多次元配列となります。</para>
     <para>
     ディレクトリに特定のエントリを置いている場合、
     この関数をコールすることにより、そのエントリに関して保持されている情報
     得ることができます。
     ディレクトリエントリを "ブラウズ" するか、ディレクトリエントリの
     構造が未知であるアプリケーションにおいてこの関数を使用します。
     電子メールアドレスや姓のような特定の属性を検索す多くのアプリケーション
     においては、保持されている他のデータにどんなものがあるか
     ということは問題になりません。</para>
	<para>
	<informalexample><literallayout>
    return_value["count"] = そのエントリの属性の数
    return_value[0] = 最初の属性
    return_value[n] = n 番目の属性

    return_value["attribute"]["count"] = その属性に関する値の数
    return_value["attribute"][0] = その属性に関する最初の値
    return_value["attribute"][i] = その属性に関する i 番目の値
</literallayout></informalexample>

     <example>
      <title>特定のディレクトリエントリに関して保持されている属性のリストを
表示</title>
 <programlisting role="php">
 // $ds はディレクトリのリンク ID
 
 // $sr は事前の LDAP のディレクトリ検索コールの有効な結果
 
 $entry = ldap_first_entry($ds, $sr);
 
 $attrs = ldap_get_attributes($ds, $entry);
 
 echo $attrs["count"]." attributes held for this entry:&lt;p>";
 
 for ($i=0; $i<$attrs["count"]; $i++)
     echo $attrs[$i]."&lt;br>";
 </programlisting>
 </example></para>
 
      <para>
	<function>ldap_first_attribute</function> および
	<function>ldap_next_attribute</function> も参照下さい。</para>

   </refsect1>
  </refentry>


  <refentry id="function.ldap-get-dn">
   <refnamediv>
    <refname>ldap_get_dn</refname>
    <refpurpose>結果エントリから DN を得る</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>string <function>ldap_get_dn</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_entry_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    結果エントリの DN を返します。エラーの場合、 FALSE を返します。</para>
    <para>  
	<function>ldap_get_dn</function> 関数は、結果におけるあるエントリの DN を見つける
	ために使用されます。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-get-entries">
   <refnamediv>
    <refname>ldap_get_entries</refname>
    <refpurpose>全ての結果エントリを得る</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>array <function>ldap_get_entries</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功時に完全な結果情報を多次元配列で返します。
    エラーの場合に FALSE を返します。</para>
    <para>  
    <function>ldap_get_entries</function> 関数は、結果から複数のエントリを読み込み、
    続いて属性と複数の値を読み込むことを簡単に行うために使用されます。
    全ての情報が一回の関数コールにより多次元配列で返されます。
    配列の構造は、次のようになります。</para>
    <para>
    属性インデックスは、小文字に変換されます
    (属性は大文字小文字を区別しますが、配列インデックスとして使用する時は
    区別されません)

    <informalexample>
<literallayout>
    return_value["count"] = 結果におけるエントリの数
    return_value[0] : 最初のエントリの詳細情報を参照します

    return_value[i]["dn"] =  結果における i 番目のエントリ DN 

    return_value[i]["count"] = i 番目のエントリにおける属性の数
    return_value[i][j] = 結果における i 番目のエントリにおける j 番目の属性

    return_value[i]["attribute"]["count"] = i 番目のエントリにおける属性に関する値の数
    return_value[i]["attribute"][j] = i 番目のエントリにおける j 番目の値
</literallayout>
    </informalexample></para>
	
	<para>
	<function>ldap_first_entry</function> および
	<function>ldap_next_entry</function> も参照下さい。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-get-values">
   <refnamediv>
    <refname>ldap_get_values</refname>
    <refpurpose>結果エントリから全ての値を得る</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>array <function>ldap_get_values</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_entry_identifier</parameter></paramdef>
      <paramdef>string <parameter>attribute</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功した場合、指定した属性に関する値を配列を返します。
    エラーの場合には、 FALSE を返します。</para>
    <para>  
    <function>ldap_get_values</function> 関数は、結果のエントリにおける属性の全ての値を
    読み込むために使用されます。
    エントリは、<parameter>result_entry_identifier</parameter>
     により指定されます。
    値の数は、結果を有する配列において "count" とインデックス指定することに
    より得ることができます。
    個々の値は、配列において整数インデックスを指定することによりアクセス
    できます。
    最初のインデックスは、0 です。</para>
    <para> 
    この関数のコールは、<parameter>result_entry_identifier</parameter>
    を必要とします。このため、
    事前に LDAP の検索用関数のコールと個々のエントリ取得用
    関数のコールを行っておく必要があります。</para>
     <para>
     アプリケーションでは、
     ("surname" または "mail" のような)特定の属性を探すために
     その特性をコードに埋め込んで置くか、さもなくば、
     指定したエントリに関して存在する属性を調べるために
     <function>ldap_get_attributes</function> をコールする必要があります。</para>
     <para>
     LDAP ではある属性に関して複数のエントリを持つことが可能です。
     このため、例えば、ある人に関する "mail" という属性で呼ばれる全ての
     ディレクトリエントリについて多数の電子メールアドレスを保存することが
     できます。
 
	<informalexample>
<literallayout>
    return_value["count"] = 属性の値の数
    return_value[0] = 属性の最初の値
    return_value[i] = 属性の i 番目の値
</literallayout>
	</informalexample>
      <example>
       <title>あるディレクトリエントリの全ての "mail" 属性の一覧を表示します
</title>
 <programlisting role="php">
 // $ds はディレクトリサーバーの有効なリンク ID
 
 // $sr は事前の LDAP 検索コールのどれかから返された有効な検索結果
 
 // $entry はディレクトリエントリを返すコールのどれかから返された有効な
 // エントリ ID
 
 $values = ldap_get_values($ds, $entry,"mail");
 
 echo $values["count"]." email addresses for this entry.&lt;p>";
 
 for ($i=0; $i &lt; $values["count"]; $i++)
     echo $values[$i]."&lt;br>";
 </programlisting>
      </example></para>
 
   </refsect1>
  </refentry>

  <refentry id="function.ldap-get-values-len">
   <refnamediv>
    <refname>ldap_get_values_len</refname>
    <refpurpose>結果エントリから全てのバイナリ値を得る</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>array <function>ldap_get_values_len</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_entry_identifier</parameter></paramdef>
      <paramdef>string <parameter>attribute</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
     成功時に属性の値を配列で返し、エラー時に false を返します。
    </para>
    <para>  
     <function>ldap_get_values_len</function> 関数は、結果のエントリにおける
     全ての属性の値を読みこむために使用されます。エントリは、
     <parameter>result_entry_identifier</parameter> により指定されます。
     値の数は、結果の配列の "count" というキーを有する要素から知ること
    ができます。
     個々の値は、配列インデックスによりアクセスします。最初のインデッ
    クスは、0 です。
    </para>
    <para>
     この関数は、文字列データではなくバイナリデータを処理すること以外は、
     <function>ldap_get_values</function> と全く同じです。
    </para>
    <note>
     <para>
      この関数は4.0で追加されました。
     </para>
    </note>
   </refsect1>
  </refentry>



  <refentry id="function.ldap-list">
   <refnamediv>
    <refname>ldap_list</refname>
    <refpurpose>シングルレベル探索を行う</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_list</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>base_dn</parameter></paramdef>
      <paramdef>string <parameter>filter</parameter></paramdef>
      <paramdef>array
       <parameter><optional>attributes</optional></parameter></paramdef>
      <paramdef>int 
       <parameter><optional>attrsonly</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>sizelimit</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>timelimit</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>deref</optional></parameter>
      </paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
     検索結果IDを返します。エラーの場合は、falseを返します。
    </para>
    <para>  
     <function>ldap_list</function> は、指定されたフィルタを用いて
     LDAP_SCOPE_ONELEVELのスコープを有するディレクトリの検索を行います。
    </para>
    <para>
     LDAP_SCOPE_ONELEVEL は、検索によりコール時に指定した DN の直下の
     レベルにおける情報のみ返されることを意味します。
     ("ls" と入力した際に、現在のワークディレクトリのファイルとフォルダー
     の一覧が得られるのと同じです)
    </para>
    <para>
     この関数のコールは、オプションのパラメータを5つとります。
     <function>ldap_search</function> の記述を参照下さい。
    <note>
     <para>
       以下のオプションパラメータは4.0.2で追加されました:
      <parameter>attrsonly</parameter>,
      <parameter>sizelimit</parameter>,
      <parameter>timelimit</parameter>,
      <parameter>deref</parameter>
     </para>
    </note>

     <example>
      <title>ある組織の全ての組織単位を一覧表示する 
      </title>
<programlisting role="php3">
// $ds はディレクトリサーバーの有効なリンク ID
 
$basedn = "o=My Company, c=US";
$justthese = array("ou");
 
$sr=ldap_list($ds, $basedn, "ou=*", $justthese);
 
$info = ldap_get_entries($ds, $sr);
 
for ($i=0; $i<$info["count"]; $i++)
    echo $info[$i]["ou"][0] ;
      </programlisting>
     </example>
    </para>
   </refsect1>
  </refentry>

  <refentry id="function.ldap-modify">
   <refnamediv>
    <refname>ldap_modify</refname>
    <refpurpose>LDAP エントリを修正する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_modify</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>dn</parameter></paramdef>
      <paramdef>array <parameter>entry</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功時にTRUE 、エラー時に FALSE を返します。</para>
    <para>  
    <function>ldap_modify</function> 関数は、LDAP ディレクトリに存在するエントリを
    修正するために使用されます。
    エントリ(entry)の構造は、<function>ldap_add</function> と同じです。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-next-attribute">
   <refnamediv>
    <refname>ldap_next_attribute</refname>
    <refpurpose>結果における次の属性を得る</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>string <function>ldap_next_attribute</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_entry_identifier</parameter></paramdef>
      <paramdef>int <parameter>ber_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功した場合、エントリにおける次の属性を返します。
    エラー時に FALSE を返します。</para>
    <para>  
    <function>ldap_next_attribute</function> は、あるエントリにおいて
    属性を得るためにコールされます。ポインタの内部状態は、
    <parameter>ber_identifier</parameter> により保持されます。
    この ID は、参照により関数に渡されます。
    最初に<function>ldap_next_attribute</function>をコールした際には、
    <function>ldap_first_attribute</function> から返された
    <parameter>result_entry_identifier</parameter> が使用されます。</para>
	<para>
	<function>ldap_get_attributes</function> も参照下さい。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-next-entry">
   <refnamediv>
    <refname>ldap_next_entry</refname>
    <refpurpose>次の結果エントリを得る</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_next_entry</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>int <parameter>result_entry_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    <function>ldap_first_entry</function> によりエントリが読み始められた
    結果において次のエントリに関するエントリID を返します。
    これ以上結果のエントリがない場合は、 FALSE を返します。</para>
    <para>  
    <function>ldap_next_entry</function> は、結果に保持されたエントリを
    得るために使用されます。

    連続的に <function>ldap_next_entry</function> をコールした場合、
    エントリがなくなるまでエントリを一つずつ返します。
    <function>ldap_next_entry</function> への最初のコールは、
    <function>ldap_first_entry</function> をresult_entry_identifier
    を指定してコールした後に行われます。
    <function>ldap_get_entries</function> も参照下さい。</para>
   </refsect1>
  </refentry>


  <refentry id="function.ldap-read">
   <refnamediv>
    <refname>ldap_read</refname>
    <refpurpose>エントリを読み込む</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_read</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>base_dn</parameter></paramdef>
      <paramdef>string <parameter>filter</parameter></paramdef>
      <paramdef>array 
       <parameter><optional>attributes</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>attrsonly</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>sizelimit</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>timelimit</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>deref</optional></parameter>
      </paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
     サーチ結果IDを返します。エラーの場合にfalseを返します。
    </para>
    <para>  
     <function>ldap_read</function> は、スコープ LDAP_SCOPE_BASE を有する
     ディレクトリを指定されたフィルタで探索を行います。
     これは、ディレクトリからエントリを読み込むことと等価です。
    </para>
    <para>
     フィルタ(filter)は必ず指定する必要があります。
     このエントリに関する全ての情報を完全に取得したい場合、
     "objectClass=*" というフィルタを使用して下さい。
      ディレクトリサーバーで使用されるエントリの型が分かっている場合、
     "objectClass=inetOrgPerson" のような適当なフィルターを使用すること
     ができます。
    </para>
    <para>
     この関数は、オプションのパラメータを5つとります。
     <function>ldap_search</function> の記述を参照下さい。
    </para>
   </refsect1>
  </refentry>

  <refentry id="function.ldap-search">
   <refnamediv>
    <refname>ldap_search</refname>
    <refpurpose>LDAP ツリーを探索する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_search</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
      <paramdef>string <parameter>base_dn</parameter></paramdef>
      <paramdef>string <parameter>filter</parameter></paramdef>
      <paramdef>array 
       <parameter><optional>attributes</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>attrsonly</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>sizelimit</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>timelimit</optional></parameter>
      </paramdef>
      <paramdef>int 
       <parameter><optional>deref</optional></parameter>
      </paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
     サーチ結果IDを返します。エラーの場合にfalseを返します。
    </para>
    <para>  
     <function>ldap_search</function> は、
     LDAP_SCOPE_SUBTREE のスコープを有するディレクトリに関して、
     指定されたフィルタにより検索を行います。
     これは、ディレクトリ全体を探索することと等価です。
     <parameter>base_dn</parameter> はディレクトリのベース DN を指定し
     ます。
    </para>
    <para>
     サーバーから返される属性と値を必要なものだけに制限するために
     オプションの4番目のバラメータを指定することができます。
     これは、(全ての属性と関連する値を返す)デフォルトの動作よりも
     かなり効率的です。
     このため、4番目のパラメータを使用することが望ましいです。
    </para>
    <para>
     4番目のパラメータは、array("mail","sn","cn") のような
     必要な属性を保持する通常の PHP 文字列配列です。
     "dn" は要求された属性の型によらず常に返されることに注意して下さい。
    </para>
     <para>
     いくつかのディレクトリサーバーホストが返すエントリは、事前に指定された
     エントリ数を超えないように設定されています。このような場合、サー
     バーは結果セットの一部のみを返すことがあります。
    </para>






     <para>
     検索フィルターは、
     LDAP ドキュメントに記述されたフォーマットの論理演算子を用いて、
     簡単なものまたは先進的なものとすることができます。
     (フィルターに関する詳細な情報については、
      <ulink url="&url.ldap.netscape;">Netscape Directory SDK</ulink>
      を参照下さい)</para>
     <para>
     以下の例は、"My Company" の全員について
     姓または名に部分文字列 $person を含まれる
     組織単位、姓、名、電子メールアドレスを取得します。
     この例は、複数の属性に関する情報についてサーバーに
     検索をかける論理フィルターを使用します。
 
      <example>
       <title>LDAP 検索</title>
 <programlisting role="php">
 // $ds は、ディレクトリサーバーの有効なリンク ID
 
 // $person は、人名またはその一部。例 "Jo"
 
 $dn = "o=My Company, c=US";
 $filter="(|(sn=$person*)(givenname=$person*))";
 $justthese = array( "ou", "sn", "givenname", "mail");
 
 $sr=ldap_search($ds, $dn, $filter, $justthese);
 
 $info = ldap_get_entries($ds, $sr);
 
 print $info["count"]." 個のエントリが返されました&lt;p>";
 </programlisting>
       </example></para>
 
   </refsect1>
  </refentry>


  <refentry id="function.ldap-unbind">
   <refnamediv>
    <refname>ldap_unbind</refname>
    <refpurpose>LDAP ディレクトリへのバインドを解除する</refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_unbind</function></funcdef>
      <paramdef>int <parameter>link_identifier</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
    成功時にTRUE 、エラー時に FALSE を返します。</para>
    <para>  
    <function>ldap_unbind</function> 関数は、LDAP ディレクトリへの
    バインドを解除します。</para>
   </refsect1>
  </refentry>

  <refentry id="function.ldap-err2str">
   <refnamediv>
    <refname>ldap_err2str</refname>
    <refpurpose>
     LDAP のエラー番号をエラーメッセージ文字列に変換する
    </refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>string <function>ldap_err2str</function></funcdef>
      <paramdef>int <parameter>errno</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
     エラーメッセージ文字列を返します。</para>
    <para>
     この関数は、エラー番号 errno が意味するエラーメッセージ文字列
     を返します。LDAP errno 番号は標準化されていますが、
     異なったライブラリでは、異なるかローカライズされたエラーメッセージ
     が返されます。特性のエラーメッセージをチェックするのではなく、
     常に必ずエラー番号をチェックするようにしてください。</para>
    <para>
     <function>ldap_errno</function> および
     <function>ldap_error</function> も参照下さい。
  
    <example>
     <title>全ての LDAP エラーメッセージに番号をふる</title>
<programlisting role="php">
&lt;?php
  for($i=0; $i<100; $i++) {
    printf("Error $i: %s&lt;br>\n", ldap_str2err($i));
  }
?>
</programlisting>
    </example></para>
   </refsect1>
  </refentry>

  <refentry id="function.ldap-errno">
   <refnamediv>
    <refname>ldap_errno</refname>
    <refpurpose>
     直近の LDAP コマンドのLDAP エラー番号を返す
    </refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>int <function>ldap_errno</function></funcdef>
      <paramdef>int <parameter>link_id</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
     このリンクに関する直近のLDAPコマンドのLDAPエラー番号を返します。</para>
    <para>
     この関数は、指定したリンクIDに関して直近のLDAPコマンドにより返された
     標準化されたエラー番号を返します。この番号は、<function>ldap_err2str</function>
     を用いてエラーメッセージ文字列に変換することができます。</para>
    <para>
     php3.ini で警告レベルを十分に下げるか、警告出力を抑制するために LDAP 
     コマンドを @ 文字をつけない限り、発生したエラーは、HTML 出力
     にも表示されます。
     <example>
      <title>エラーを生成し、取得する</title>
<programlisting role="php">
&lt;?php
// この例には、エラーがあり、これを取得します。
$ld = ldap_connect("localhost");
$bind = ldap_bind($ld);
// フィルター式に構文エラーがあります。
// 動作するには、"objectclass=*" とする必要があります。
$res =  @ldap_search($ld, "o=Myorg, c=DE", "objectclass");
if (!$res) {
    printf("LDAP-Errno: %s&lt;br>\n", ldap_errno($ld));
    printf("LDAP-Error: %s&lt;br>\n", ldap_error($ld));
    die("Argh!&lt;br>\n");
}
$info = ldap_get_entries($ld, $res);
printf("%d matching entries.&lt;br>\n", $info["count"]);
?>
</programlisting>
    </example></para>
    <para>
     <function>ldap_err2str</function> および
     <function>ldap_error</function> も参照下さい。</para>
   </refsect1>
  </refentry>
  
  <refentry id="function.ldap-error">
   <refnamediv>
    <refname>ldap_error</refname>
    <refpurpose>
     直近のLDAPコマンドのLDAP エラーメッセージを返す
    </refpurpose>
   </refnamediv>
   <refsect1>
    <title>説明</title>
    <funcsynopsis>
     <funcprototype>
      <funcdef>string <function>ldap_error</function></funcdef>
      <paramdef>int <parameter>link_id</parameter></paramdef>
     </funcprototype>
    </funcsynopsis>
    <para>
     エラーメッセージ文字列を返します。</para>
    <para>
     この関数は、指定したリンクIDに関して直近のLDAPコマンドにより生成された
     エラーを表すエラーメッセージ文字列を返します。LDAP errno 番号は
     標準化されていますが、
     異なったライブラリでは、異なるかローカライズされたエラーメッセージ
     が返されます。特性のエラーメッセージをチェックするのgはなく、
     常に必ずエラー番号をチェックするようにしてください。</para>
    <para>
     <filename>php3.ini</filename>で警告レベルを十分に下げるか、
     警告出力を抑制するためにLDAPコマンドの前に<literal>@</literal> 文字を
     つけない限り、発生したエラーはHTML 出力にも表示されます。</para>
    <para>
     <function>ldap_err2str</function> および
     <function>ldap_errno</function> も参照下さい。</para>
   </refsect1>
  </refentry>
 </reference>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
