<?xml version="1.0" encoding="utf-8"?>

<!-- $Revision$ -->
<!-- EN-Revision: b2cfbc95b579db63e043fb19dedac65026f04b29 Maintainer: takagi Status: working -->
<refentry xml:id="mongocursor.batchsize" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <refnamediv>
  <refname>MongoCursor::batchSize</refname>
  <refpurpose>ひとつのバッチで返す要素数を制限する</refpurpose>
 </refnamediv>

 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <modifier>public</modifier> <type>MongoCursor</type><methodname>MongoCursor::batchSize</methodname>
   <methodparam><type>int</type><parameter>batchSize</parameter></methodparam>
  </methodsynopsis>
  <para>
   A cursor typically fetches a batch of result objects and store them
   locally. This method sets the batchSize value to configure the amount of
   documents retrieved from the server in one data packet. However, it will
   never return more documents than fit in the max batch size limit (usually
   4MB).  
  </para>
 </refsect1>

 <refsect1 role="parameters">
  &reftitle.parameters;  
  <para>
   <variablelist>
    <varlistentry>
     <term>
      <parameter>batchSize</parameter>
     </term>
     <listitem>
      <para>
       バッチで返す結果の数。バッチごとにサーバーとのやりとりが発生します。
      </para>
      <para>
       If <parameter>batchSize</parameter> is <emphasis>2 or
       more</emphasis>, it represents the size of each batch of objects retrieved.
       It can be adjusted to optimize performance and limit data transfer.
      </para>
      <para>
       If <parameter>batchSize</parameter> is <literal>1</literal> or negative, it
       will limit of number returned documents to the absolute value of batchSize,
       and the cursor will be closed. For example if
       batchSize is <literal>-10</literal>, then the server will return a maximum
       of 10 documents and as many as can fit in 4MB, then close the cursor.
      </para>
      <warning>
       <para>
        A <parameter>batchSize</parameter> of <literal>1</literal> is special, and
        means the same as <literal>-1</literal>, i.e. a value of
        <literal>1</literal> makes the cursor only capable of returning
        <emphasis>one</emphasis> document.
       </para>
      </warning>
      <para>
       Note that this feature is different from
       <function>MongoCursor::limit</function> in that documents must fit within a
       maximum size, and it removes the need to send a request to close the cursor
       server-side. The batch size can be changed even after a cursor is iterated,
       in which case the setting will apply on the next batch retrieval. 
      </para>
      <para>
       This cannot override MongoDB's limit on the amount of data it will return to 
       the client (i.e., if you set batch size to 1,000,000,000, MongoDB will still 
       only return 4-16MB of results per batch). 
      </para>
      <para>
       To ensure consistent behavior, the rules of
       <function>MongoCursor::batchSize</function> and
       <function>MongoCursor::limit</function> behave a 
       little complex but work "as expected".  The rules are: hard limits override 
       soft limits with preference given to <function>MongoCursor::limit</function>
       over <function>MongoCursor::batchSize</function>.  After that, whichever is 
       set and lower than the other will take precedence. See below.
       section for some examples.
      </para>
     </listitem>
    </varlistentry>   
   </variablelist>
  </para>
 </refsect1>

 <refsect1 role="returnvalues">
  &reftitle.returnvalues;  
  <para>
   このカーソルを返します。
  </para>
 </refsect1>

 <refsect1 role="errors">
  &reftitle.errors;
  <para>
   このカーソルの反復処理が始まっている場合に <classname>MongoCursorException</classname> をスローします。
  </para>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <example>
   <title><function>Mongo::batchSize</function> を
   <function>MongoCursor::limit</function> と組み合わせる例</title>
   <programlisting role="php">
<![CDATA[
<?php

// ひとつのバッチで最大 10 件。-10 でサーバーから 10 件を返し、
// カーソルを削除する。
$cursor->limit(20)->batchSize(-10);

// 最初のバッチ。最大 10 件
$cursor->limit(10);

// 最初のバッチ。最大 10 件
$cursor->limit(10)->batchSize(20);

// 結果を 10 件ずつのバッチで取得し、最大で 20 件
// (10 件のバッチが二つ) を返す
$cursor->limit(20)->batchSize(10);

// 結果を 7 件ずつのバッチで取得し、最大で 30 件を返す
// (ドライバが 7 件のバッチを 4 回リクエストし、最後のバッチは 2 件となる)
$cursor->limit(30)->batchSize(7)
?>
]]>
   </programlisting>
  </example>
 </refsect1>

 <refsect1 role="seealso">
  &reftitle.seealso;
  <para>
   MongoDB コアドキュメントの <link xlink:href="&url.mongodb.dochub.limit;">limit</link>。
  </para>
  <para>
   <simplelist>
    <member><function>MongoCursor::limit</function></member>
   </simplelist>
  </para>
 </refsect1>
</refentry>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
--> 
