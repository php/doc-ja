<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: f246bdbf5f450a3aa7bb6cf5dfa3637b134c5887 Maintainer: satoruyoshida Status: working -->
<appendix xml:id="mysqlnd-qc.constants" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 &reftitle.constants;
 &extension.constants;
 <para>
  <emphasis role="bold">SQL ヒント関係</emphasis>
 </para>
 <para>
  <example>
   <para>
    クエリ・キャッシュは、SQL ヒントによって制御されます。
    SQL ヒントは、キャッシングを有効または無効にするために使用します。
    SQL ヒントは、クエリの <literal>TTL</literal> を設定するために使用できます。
   </para>
   <para>
    クエリ・キャッシュで認識される SQL ヒントは、コンパイル時に手動で変更できます。
    これは、デフォルトの SQL ヒントが他のシステムによってすでに取り入れられて、
    解釈・実行された環境で、<literal>mysqlnd_qc</literal> を使用できるようにします。
    この理由から、クエリ文字列にデフォルトの SQL ヒントを手動で追加する代わりに、
    SQL ヒント文字列定数を使用することを推奨します。
   </para>
   <programlisting role="php">
<![CDATA[
<?php
/* 可搬性を最大にするために定数を使用 */
$query = "/*" . MYSQLND_QC_ENABLE_SWITCH . "*/SELECT id FROM test";

/* 有効ですが、可搬性がより少なくなります: デフォルトの TTL */
$query = "/*qc=on*/SELECT id FROM test";

/* 有効ですが、可搬性がより少なくなります: ステートメント TTL 単位 */
$query = "/*qc=on*//*qc_ttl=5*/SELECT id FROM test";

printf("MYSQLND_QC_ENABLE_SWITCH: %s\n", MYSQLND_QC_ENABLE_SWITCH);
printf("MYSQLND_QC_DISABLE_SWITCH: %s\n", MYSQLND_QC_DISABLE_SWITCH);
printf("MYSQLND_QC_TTL_SWITCH: %s\n", MYSQLND_QC_TTL_SWITCH);
?>
]]>
   </programlisting>
   &examples.outputs;
   <screen>
<![CDATA[
MYSQLND_QC_ENABLE_SWITCH: qc=on
MYSQLND_QC_DISABLE_SWITCH: qc=off
MYSQLND_QC_TTL_SWITCH: qc_ttl=

]]>
   </screen>

  </example>
 </para>

 <para>
  <variablelist>
   <varlistentry xml:id="constant.mysqlnd-qc-enable-switch">
    <term>
     <constant>MYSQLND_QC_ENABLE_SWITCH</constant>
     (
     <type>string</type>)
    </term>
    <listitem>
     <simpara>
      クエリをキャッシュに格納できるようにするために使用する SQL ヒント。
     </simpara>

    </listitem>
   </varlistentry>
   <varlistentry xml:id="constant.mysqlnd-qc-disable-switch">
    <term>
     <constant>MYSQLND_QC_DISABLE_SWITCH</constant>
     (
     <type>string</type>)
    </term>
    <listitem>
     <simpara>
      <literal>mysqlnd_qc.cache_by_default = 1</literal> の場合に
      クエリをキャッシュに格納できないようにするために使用する SQL ヒント。
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="constant.mysqlnd-qc-ttl-switch">
    <term>
     <constant>MYSQLND_QC_TTL_SWITCH</constant>
     (
     <type>string</type>)
    </term>
    <listitem>
     <simpara>
      結果セットの TTL を設定するために使用する SQL ヒント
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="constant.mysqlnd-qc-server-id">
    <term>
     <constant>MYSQLND_QC_SERVER_ID_SWITCH</constant>
     (
     <type>string</type>)
    </term>
    <listitem>
     <simpara>
      This SQL hint should not be used in general.
     </simpara>
     <simpara>
      It is needed by <link linkend="book.mysqlnd-ms">PECL/mysqlnd_ms</link>
      to group cache entries for one statement
      but originating from different physical connections. If the
      hint is used connection settings such as user, hostname and charset
      are not considered for generating a cache key of a query.
      Instead the given value and the query string are used as input
      to the hashing function that generates the key.
     </simpara>
     <simpara>
      PECL/mysqlnd_ms may, if instructed, cache results from
      MySQL Replication slaves. Because it can hold many connections
      to the slave the cache key shall not be formed from the user,
      hostname or other settings that may vary for the various slave
      connections. Instead, PECL/mysqlnd_ms provides an identifier
      which refers to the group of slave connections that shall be enabled
      to share cache entries no matter which physical slave connection was
      to generate the cache entry.
     </simpara>
     <simpara>
      Use of this feature outside of PECL/mysqlnd_ms is not recommended.
     </simpara>
    </listitem>
   </varlistentry>
  </variablelist>
 </para>

 <para>
  <emphasis role="bold"><function>mysqlnd_qc_set_cache_condition</function> related</emphasis>
 </para>
 <para>
  <example>
   <para>
    The function <function>mysqlnd_qc_set_cache_condition</function> allows setting conditions
    for automatic caching of statements which don't begin with the SQL hints
    necessary to manually enable caching.
   </para>
   <programlisting role="php">
<![CDATA[
<?php
/* Cache all accesses to tables with the name "new%" in schema/database "db_example" for 1 second */
if (!mysqlnd_qc_set_cache_condition(MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN, "db_example.new%", 1)) {
  die("Failed to set cache condition!");
}

$mysqli = new mysqli("host", "user", "password", "db_example", "port");
/* cached although no SQL hint given  */
$mysqli->query("SELECT id, title FROM news");

$pdo_mysql = new PDO("mysql:host=host;dbname=db_example;port=port", "user", "password");
/* not cached: no SQL hint, no pattern match */
$pdo_mysql->query("SELECT id, title FROM latest_news");
/* cached: TTL 1 second, pattern match */
$pdo_mysql->query("SELECT id, title FROM news");
?>
]]>
   </programlisting>
  </example>
 </para>
 <para>
  <variablelist>
   <varlistentry xml:id="constant.mysqlnd-qc-condition-meta-schema-pattern">
    <term>
     <constant>MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN</constant>
     (
     <type>int</type>)
    </term>
    <listitem>
     <simpara>
       Used as a parameter of <function>mysqlnd_qc_set_cache_condition</function>
       to set conditions for schema based automatic caching.
     </simpara>
    </listitem>
   </varlistentry>
  </variablelist>
 </para>
</appendix>





<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
