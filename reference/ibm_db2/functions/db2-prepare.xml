<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 020edc73be983e8e2aca04782ff7c901da4afad7 Maintainer: takagi Status: ready -->
<refentry xmlns="http://docbook.org/ns/docbook" xml:id="function.db2-prepare">
 <refnamediv>
  <refname>db2_prepare</refname>
  <refpurpose>
   実行する SQL 文を準備する
  </refpurpose>
 </refnamediv>
 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <type class="union"><type>resource</type><type>false</type></type><methodname>db2_prepare</methodname>
   <methodparam><type>resource</type><parameter>connection</parameter></methodparam>
   <methodparam><type>string</type><parameter>statement</parameter></methodparam>
   <methodparam choice="opt"><type>array</type><parameter>options</parameter><initializer>[]</initializer></methodparam>
  </methodsynopsis>


  <simpara>
   <function>db2_prepare</function> は、プリペアドステートメントを作成します。
   このプリペアドステートメントには、入力パラメータ・出力パラメータ
   あるいは入出力パラメータを表すパラメータマーカ (<literal>?</literal>)
   を含めることができます。プリペアドステートメントにパラメータを渡すには
   <function>db2_bind_param</function> を使用します。
   入力パラメータの場合についてのみ、<function>db2_execute</function>
   に渡す配列で指定することも可能です。
  </simpara>
  <para>
   アプリケーション内でプリペアドステートメントを使用する利点は、
   以下の 3 つです。
   <itemizedlist>
    <listitem>
     <simpara>
      <emphasis>パフォーマンス</emphasis>: 事前に文を準備しておくと、
      その文によってデータを取得するための実行計画をデータベースサーバーが
      最適化します。その後 <function>db2_execute</function>
      でプリペアドステートメントを実行する際にはこの実行計画が再利用され、
      実行時に実行計画を毎回作成することによるオーバーヘッドを避けられます。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <emphasis>セキュリティ</emphasis>: 事前に文を準備する際に、
      入力値にパラメータマーカを含めることができます。
      入力値にプレースホルダを使用してプリペアドステートメントを実行すると、
      入力値の型がカラム定義あるいはパラメータ定義と一致することを
      データベースサーバーがチェックします。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      <emphasis>高機能</emphasis>: パラメータマーカの機能は、
      単に入力値をプリペアドステートメントに渡すだけではありません。
      <function>db2_bind_param</function> を使用すると、
      ストアドプロシージャの OUT パラメータおよび INOUT パラメータから
      値を取得することも可能です。
     </simpara>
    </listitem>
   </itemizedlist>
  </para>

 </refsect1>
 <refsect1 role="parameters">
  &reftitle.parameters;
  <variablelist>
   <varlistentry>
    <term><parameter>connection</parameter></term>
    <listitem>
     <simpara>
      <function>db2_connect</function> あるいは <function>db2_pconnect</function>
      が返した有効なデータベース接続リソース。
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>statement</parameter></term>
    <listitem>
     <simpara>
      ひとつ以上のパラメータマーカを含む SQL 文。
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>options</parameter></term>
    <listitem>
     <simpara>
      文のオプションを含む連想配列。
      データベースサーバーがその機能をサポートしている場合に、
      このパラメータを使用してスクロール可能なカーソルの使用を
      要求することができます。
     </simpara>
     <simpara>
      オプションについての説明は
      <function>db2_set_option</function> を参照ください。
     </simpara>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>
 <refsect1 role="returnvalues">
  &reftitle.returnvalues;
  <simpara>
   SQL 文のパースに成功し、データベースサーバー内で正しく準備された場合に
   ステートメントリソースを返します。データベースサーバーがエラーを返した場合に
   &false; を返します。返されたエラーの詳細を調べるには、
   <function>db2_stmt_error</function> あるいは <function>db2_stmt_errormsg</function>
   をコールします。
  </simpara>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <example>
   <title>パラメータマーカを使用した SQL 文の準備と実行</title>
   <simpara>
    以下の例では、4 つのパラメータマーカを含む INSERT 文を準備し、
    入力値の配列を含む配列を順に処理しながら
    <function>db2_execute</function> に値を渡します。
   </simpara>
   <programlisting role="php">
<![CDATA[
<?php
$animals = array(
    array(0, 'cat', 'Pook', 3.2),
    array(1, 'dog', 'Peaches', 12.3),
    array(2, 'horse', 'Smarty', 350.0),
);

$insert = 'INSERT INTO animals (id, breed, name, weight)
    VALUES (?, ?, ?, ?)';
$stmt = db2_prepare($conn, $insert);
if ($stmt) {
    foreach ($animals as $animal) {
        $result = db2_execute($stmt, $animal);
    }
}
?>
]]>
   </programlisting>
  </example>
 </refsect1>

 <refsect1 role="seealso">
  &reftitle.seealso;
  <simplelist>
   <member><function>db2_bind_param</function></member>
   <member><function>db2_execute</function></member>
   <member><function>db2_stmt_error</function></member>
   <member><function>db2_stmt_errormsg</function></member>
  </simplelist>
 </refsect1>

</refentry>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
