<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: cb2e7b70b1354e5468e538720d59c37e273bc98e Maintainer: satoruyoshida Status: working -->
<chapter xml:id="oci8.fan" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>OCI8 高速アプリケーション通知 (FAN) サポート</title>
 <section>
  <para>
   FAN サポートは、高速接続フェイルオーバーという
   Oracle Database 高可用性機能を提供します。
   これにより、データベースマシンまたはデータベース・インスタンスが使用不能になると、
   PHP OCI8 スクリプトに通知されるようになります。
   FAN を使用しないと、数分間かもしれませんが、
   TCP タイムアウトが発生してエラーが返されるまで
   OCI8 がハングアップすることがありえます。
   OCI8 で FAN を有効にすると、
   Web ユーザーが機能停止に気づかないように
   アプリケーションがエラーを検出し、
   使用可能なデータベース・インスタンスに再接続できるようになります。
  </para>
  <para>
   FAN サポートは、PHP とリンクする Oracle クライアント・ライブラリ、
   および Oracle Database の両方のバージョンが 10gR2 以降の場合に使用可能です。
  </para>
  <para>
   データベースインスタンスを生き残らせるための接続がただちに作成されるので、
   FAN は、Oracle のクラスタリング技術 (RAC) のユーザーに役立ちます。
   ブローカーがある場合の Oracle Data Guard のユーザーは、
   スタンバイ用のデータベースがオンラインになる際に
   FAN イベントが生成されることに気づくでしょう。
   スタンドアローンのデータベースは、データベース再始動の際に FAN イベントを送信します。
  </para>
  <para>
   <!-- !! to be translated -->
   For active connections,
   when a machine or database instance becomes unavailable,
   a connection failure error will be returned 
   by the OCI8 extension function currently being called. 
   On a subsequent PHP script re-connect,
   a connection to a surviving database instance will be established.
   The OCI8 extension also transparently cleans up any idle connections
   affected by a database machine or instance failure
   so PHP connect calls will establish a fresh connection
   without the script being aware of any service disruption.
  </para>
  <para>
   <link linkend="ini.oci8.events">oci8.events</link> が
   <literal>On</literal> の場合、
   <!-- !! to be translated -->
   it is suggested to
   set <link linkend="ini.oci8.ping-interval">oci8.ping_interval</link>
   to -1 to disable pinging,
   since enabling FAN events provide pro-active connection management of idle connections
   made invalid by a service disruption.
  </para>
  <para>
   PHP OCI8 で FAN サポートを有効にするには、
   Oracle 10gR2 以降のライブラリとともに PHP OCI8 をビルドし、
   それらのステップに従います。
  </para>
  <para>
   <itemizedlist>
    <listitem>
     <simpara>
      データベースサービスが FAN イベントをポストできるようにするには、
      特権を持つデータベース管理者として SQL*Plus のようなプログラムを使用します。
      たとえば下記のように使用します。
     </simpara>
     <para>
      <informalexample>
       <screen>
<![CDATA[
    SQL> execute dbms_service.modify_service(
                   SERVICE_NAME        => 'sales',
                   AQ_HA_NOTIFICATIONS => TRUE);
]]>
       </screen>
      </informalexample>
     </para>
    </listitem>
    <listitem>
     <simpara>
      php.ini を編集して以下のように追加します。
     </simpara>
     <para>
      <informalexample>
       <screen>
<![CDATA[
    oci8.events = On
]]>
       </screen>
      </informalexample>
     </para>
    </listitem>
    <listitem>
     <simpara>
      <!-- !! -->
      If the application does not already handle OCI8 error conditions,
      modify it to detect failures and take appropriate action.
      これは、再接続や再実行のステートメントを含むかもしれません。
     </simpara>
    </listitem>
    <listitem>
     <simpara>
      アプリケーションを実行し、Oracle Database 10gR2 以降に接続します。
     </simpara>
    </listitem>
   </itemizedlist>
  </para>
 </section>
</chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

